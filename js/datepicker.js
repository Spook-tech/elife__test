var datepickers=[],days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months=["January","February","March","April","May","June","July","August","September","October","November","December"],sides={t:"top",r:"right",b:"bottom",l:"left",c:"centered"};function noop(){}var events=["click","focusin","keydown","input"];function datepicker(e,t){var n=createInstance(e,t);if(datepickers.length||applyListeners(document),n.shadowDom&&(datepickers.some(function(e){return e.shadowDom===n.shadowDom})||applyListeners(n.shadowDom)),datepickers.push(n),n.second){var a=n.sibling;adjustDateranges({instance:n,deselect:!n.dateSelected}),adjustDateranges({instance:a,deselect:!a.dateSelected}),renderCalendar(a)}return renderCalendar(n,n.startDate||n.dateSelected),n.alwaysShow&&calculatePosition(n),n}function applyListeners(e){events.forEach(function(t){e.addEventListener(t,e===document?oneHandler:shadowDomHandler)})}function createInstance(e,t){var n=sanitizeOptions(t||defaults()),a=e;if("string"==typeof a)a="#"===a[0]?document.getElementById(a.slice(1)):document.querySelector(a);else if("[object ShadowRoot]"===type(a))throw Error("Using a shadow DOM as your selector is not supported.");else for(var r,i,s,o=a.parentNode;!s;){var l=type(o);"[object HTMLDocument]"===l?s=!0:"[object ShadowRoot]"===l?(s=!0,r=o,i=o.host):o=o.parentNode}if(!a)throw Error("No selector / element found.");if(datepickers.some(function(e){return e.el===a}))throw Error("A datepicker already exists on that element.");var d=a===document.body,c=r?a.parentElement||r:d?document.body:a.parentElement,u=r?a.parentElement||i:c,h=document.createElement("div"),v=document.createElement("div");h.className="qs-datepicker-container qs-hidden",v.className="qs-datepicker";var f={shadowDom:r,customElement:i,positionedEl:u,el:a,parent:c,nonInput:"INPUT"!==a.nodeName,noPosition:d,position:!d&&n.position,startDate:n.startDate,dateSelected:n.dateSelected,disabledDates:n.disabledDates,minDate:n.minDate,maxDate:n.maxDate,noWeekends:!!n.noWeekends,weekendIndices:n.weekendIndices,calendarContainer:h,calendar:v,currentMonth:(n.startDate||n.dateSelected).getMonth(),currentMonthName:(n.months||months)[(n.startDate||n.dateSelected).getMonth()],currentYear:(n.startDate||n.dateSelected).getFullYear(),events:n.events||{},defaultView:n.defaultView,setDate:setDate,remove:remove,setMin:setMin,setMax:setMax,show:show,hide:hide,navigate:navigate,toggleOverlay:instanceToggleOverlay,onSelect:n.onSelect,onShow:n.onShow,onHide:n.onHide,onMonthChange:n.onMonthChange,formatter:n.formatter,disabler:n.disabler,months:n.months||months,days:n.customDays||days,startDay:n.startDay,overlayMonths:n.overlayMonths||(n.months||months).map(function(e){return e.slice(0,3)}),overlayPlaceholder:n.overlayPlaceholder||"4-digit year",overlayButton:n.overlayButton||"Submit",disableYearOverlay:!!n.disableYearOverlay,disableMobile:!!n.disableMobile,isMobile:"ontouchstart"in window,alwaysShow:!!n.alwaysShow,id:n.id,showAllDates:!!n.showAllDates,respectDisabledReadOnly:!!n.respectDisabledReadOnly,first:n.first,second:n.second};if(n.sibling){var m=n.sibling,y=f,p=m.minDate||y.minDate,g=m.maxDate||y.maxDate;y.sibling=m,m.sibling=y,m.minDate=p,m.maxDate=g,y.minDate=p,y.maxDate=g,m.originalMinDate=p,m.originalMaxDate=g,y.originalMinDate=p,y.originalMaxDate=g,m.getRange=getRange,y.getRange=getRange}n.dateSelected&&setCalendarInputValue(a,f);var D=getComputedStyle(u).position;d||D&&"static"!==D||(f.inlinePosition=!0,u.style.setProperty("position","relative"));var w=datepickers.filter(function(e){return e.positionedEl===f.positionedEl});return w.some(function(e){return e.inlinePosition})&&(f.inlinePosition=!0,w.forEach(function(e){e.inlinePosition=!0})),h.appendChild(v),c.appendChild(h),f.alwaysShow&&showCal(f),f}function freshCopy(e){return Array.isArray(e)?e.map(freshCopy):"[object Object]"===type(e)?Object.keys(e).reduce(function(t,n){return t[n]=freshCopy(e[n]),t},{}):e}function sanitizeOptions(e){var t=freshCopy(e);t.events&&(t.events=t.events.reduce(function(e,t){if(!dateCheck(t))throw Error('"options.events" must only contain valid JavaScript Date objects.');return e[+stripTime(t)]=!0,e},{})),["startDate","dateSelected","minDate","maxDate"].forEach(function(e){var n=t[e];if(n&&!dateCheck(n))throw Error('"options.'+e+'" needs to be a valid JavaScript Date object.');t[e]=stripTime(n)});var n=t.position,a=t.maxDate,r=t.minDate,i=t.dateSelected,s=t.overlayPlaceholder,o=t.overlayButton,l=t.startDay,d=t.id;if(t.startDate=stripTime(t.startDate||i||new Date),t.disabledDates=(t.disabledDates||[]).reduce(function(e,t){var n=+stripTime(t);if(!dateCheck(t))throw Error('You supplied an invalid date to "options.disabledDates".');if(n===+stripTime(i))throw Error('"disabledDates" cannot contain the same date as "dateSelected".');return e[n]=1,e},{}),t.hasOwnProperty("id")&&null==d)throw Error("`id` cannot be `null` or `undefined`");if(null!=d){var c=datepickers.filter(function(e){return e.id===d});if(c.length>1)throw Error("Only two datepickers can share an id.");c.length?(t.second=!0,t.sibling=c[0]):t.first=!0}var u=["tr","tl","br","bl","c"].some(function(e){return n===e});if(n&&!u)throw Error('"options.position" must be one of the following: tl, tr, bl, br, or c.');function h(e){throw Error('"dateSelected" in options is '+(e?"less":"greater")+' than "'+(e||"max")+'Date".')}if(t.position=establishPosition(n||"bl"),a<r)throw Error('"maxDate" in options is less than "minDate".');if(i&&(r>i&&h("min"),a<i&&h()),["onSelect","onShow","onHide","onMonthChange","formatter","disabler"].forEach(function(e){"function"!=typeof t[e]&&(t[e]=noop)}),["customDays","customMonths","customOverlayMonths"].forEach(function(e,n){var a=t[e],r=n?12:7;if(a){if(!Array.isArray(a)||a.length!==r||a.some(function(e){return"string"!=typeof e}))throw Error('"'+e+'" must be an array with '+r+" strings.");t[n?n<2?"months":"overlayMonths":"days"]=a}}),l&&l>0&&l<7){var v=(t.customDays||days).slice(),f=v.splice(0,l);t.customDays=v.concat(f),t.startDay=+l,t.weekendIndices=[v.length-1,v.length]}else t.startDay=0,t.weekendIndices=[6,0];"string"!=typeof s&&delete t.overlayPlaceholder,"string"!=typeof o&&delete t.overlayButton;var m=t.defaultView;if(m&&"calendar"!==m&&"overlay"!==m)throw Error('options.defaultView must either be "calendar" or "overlay".');return t.defaultView=m||"calendar",t}function defaults(){return{startDate:stripTime(new Date),position:"bl",defaultView:"calendar"}}function establishPosition(e){var t=e[0],n=e[1],a={};return a[sides[t]]=1,n&&(a[sides[n]]=1),a}function renderCalendar(e,t){var n=e.calendar.querySelector(".qs-overlay"),a=n&&!n.classList.contains("qs-hidden");t=t||new Date(e.currentYear,e.currentMonth),e.calendar.innerHTML=[createControls(t,e,a),createMonth(t,e,a),createOverlay(e,a)].join(""),a&&window.requestAnimationFrame(function(){toggleOverlay(!0,e)})}function createControls(e,t,n){return['<div class="qs-controls'+(n?" qs-blur":"")+'">','<div class="qs-arrow qs-left"></div>','<div class="qs-month-year'+(t.disableYearOverlay?" qs-disabled-year-overlay":"")+'">','<span class="qs-month">'+t.months[e.getMonth()]+"</span>",'<span class="qs-year">'+e.getFullYear()+"</span>","</div>",'<div class="qs-arrow qs-right"></div>',"</div>"].join("")}function createMonth(e,t,n){var a=t.currentMonth,r=t.currentYear,i=t.dateSelected,s=t.maxDate,o=t.minDate,l=t.showAllDates,d=t.days,c=t.disabledDates,u=t.startDay,h=t.weekendIndices,v=t.events,f=t.getRange?t.getRange():{},m=+f.start,y=+f.end,p=stripTime(new Date(e).setDate(1)),g=p.getDay()-u;p.setMonth(p.getMonth()+1),p.setDate(0);var D=p.getDate(),w=[],b=(g<0?7:0)+((g+D)/7|0)*7;b+=(g+D)%7?7:0;for(var q=1;q<=b;q++){var M=(q-1)%7,C=d[M],S=q-(g>=0?g:7+g),$=new Date(r,a,S),k=v[+$],Y=S<1||S>D,x=Y?S<1?-1:1:0,O=Y&&!l,E=O?"":$.getDate(),L=+$==+i,_=M===h[0]||M===h[1],P=c[+$]||t.disabler($)||_&&t.noWeekends||o&&+$<+o||s&&+$>+s,j=+stripTime(new Date)==+$,I=+$===m,T=+$===y,N=+$>m&&+$<y,R=m!==y,H="qs-square "+C;k&&!O&&(H+=" qs-event"),Y&&(H+=" qs-outside-current-month"),(l||!Y)&&(H+=" qs-num"),L&&(H+=" qs-active"),P&&!O&&(H+=" qs-disabled"),j&&(H+=" qs-current"),I&&y&&R&&(H+=" qs-range-start"),N&&(H+=" qs-range-middle"),T&&m&&R&&(H+=" qs-range-end"),O&&(H+=" qs-empty",E=""),w.push('<div class="'+H+'" data-direction="'+x+'">'+E+"</div>")}var V=d.map(function(e){return'<div class="qs-square qs-day">'+e+"</div>"}).concat(w);return V.unshift('<div class="qs-squares'+(n?" qs-blur":"")+'">'),V.push("</div>"),V.join("")}function createOverlay(e,t){var n=e.overlayPlaceholder,a=e.overlayButton;return['<div class="qs-overlay'+(t?"":" qs-hidden")+'">',"<div>",'<input class="qs-overlay-year" placeholder="'+n+'" inputmode="numeric" />','<div class="qs-close">&#10005;</div>',"</div>",'<div class="qs-overlay-month-container">'+e.overlayMonths.map(function(e,t){return'<div class="qs-overlay-month" data-month-num="'+t+'">'+e+"</div>"}).join("")+"</div>",'<div class="qs-submit qs-disabled">'+a+"</div>","</div>"].join("")}function selectDay(e,t,n){var a=t.el,r=t.calendar.querySelector(".qs-active"),i=e.textContent,s=t.sibling;(a.disabled||a.readOnly)&&t.respectDisabledReadOnly||(t.dateSelected=n?void 0:new Date(t.currentYear,t.currentMonth,i),r&&r.classList.remove("qs-active"),n||e.classList.add("qs-active"),setCalendarInputValue(a,t,n),n||hideCal(t),s&&(adjustDateranges({instance:t,deselect:n}),t.first&&!s.dateSelected&&(s.currentYear=t.currentYear,s.currentMonth=t.currentMonth,s.currentMonthName=t.currentMonthName),renderCalendar(t),renderCalendar(s)),t.onSelect(t,n?void 0:new Date(t.dateSelected)))}function adjustDateranges(e){var t=e.instance.first?e.instance:e.instance.sibling,n=t.sibling;t===e.instance?e.deselect?(t.minDate=t.originalMinDate,n.minDate=n.originalMinDate):n.minDate=t.dateSelected:e.deselect?(n.maxDate=n.originalMaxDate,t.maxDate=t.originalMaxDate):t.maxDate=n.dateSelected}function setCalendarInputValue(e,t,n){if(!t.nonInput){if(n)return e.value="";if(t.formatter!==noop)return t.formatter(e,t.dateSelected,t);e.value=t.dateSelected.toDateString()}}function changeMonthYear(e,t,n,a){n||a?(n&&(t.currentYear=+n),a&&(t.currentMonth=+a)):(t.currentMonth+=e.contains("qs-right")?1:-1,12===t.currentMonth?(t.currentMonth=0,t.currentYear++):-1===t.currentMonth&&(t.currentMonth=11,t.currentYear--)),t.currentMonthName=t.months[t.currentMonth],renderCalendar(t),t.onMonthChange(t)}function calculatePosition(e){if(!e.noPosition){var t=e.position.top,n=e.position.right;if(e.position.centered)return e.calendarContainer.classList.add("qs-centered");var a=e.positionedEl.getBoundingClientRect(),r=e.el.getBoundingClientRect(),i=e.calendarContainer.getBoundingClientRect(),s=r.top-a.top+(t?-1*i.height:r.height)+"px",o=r.left-a.left+(n?r.width-i.width:0)+"px";e.calendarContainer.style.setProperty("top",s),e.calendarContainer.style.setProperty("left",o)}}function dateCheck(e){return"[object Date]"===type(e)&&"Invalid Date"!==e.toString()}function stripTime(e){if(!(!dateCheck(e)&&("number"!=typeof e||isNaN(e)))){var t=new Date(+e);return new Date(t.getFullYear(),t.getMonth(),t.getDate())}}function hideCal(e){!e.disabled&&(e.calendarContainer.classList.contains("qs-hidden")||e.alwaysShow||("overlay"!==e.defaultView&&toggleOverlay(!0,e),e.calendarContainer.classList.add("qs-hidden"),e.onHide(e)))}function showCal(e){e.disabled||(e.calendarContainer.classList.remove("qs-hidden"),"overlay"===e.defaultView&&toggleOverlay(!1,e),calculatePosition(e),e.onShow(e))}function toggleOverlay(e,t){var n=t.calendar,a=n.querySelector(".qs-overlay"),r=a.querySelector(".qs-overlay-year"),i=n.querySelector(".qs-controls"),s=n.querySelector(".qs-squares");e?(a.classList.add("qs-hidden"),i.classList.remove("qs-blur"),s.classList.remove("qs-blur"),r.value=""):(a.classList.remove("qs-hidden"),i.classList.add("qs-blur"),s.classList.add("qs-blur"),r.focus())}function overlayYearEntry(e,t,n,a){var r=isNaN(+new Date().setFullYear(t.value||void 0)),i=r?null:t.value;13===e.which||13===e.keyCode||"click"===e.type?a?changeMonthYear(null,n,i,a):r||t.classList.contains("qs-disabled")||changeMonthYear(null,n,i):n.calendar.contains(t)&&n.calendar.querySelector(".qs-submit").classList[r?"add":"remove"]("qs-disabled")}function type(e){return({}).toString.call(e)}function hideOtherPickers(e){datepickers.forEach(function(t){t!==e&&hideCal(t)})}function oneHandler(e){if(!e.__qs_shadow_dom){var t=e.which||e.keyCode,n=e.type,a=e.target,r=a.classList,i=datepickers.filter(function(e){return e.calendar.contains(a)||e.el===a})[0],s=i&&i.calendar.contains(a);if(!i||!i.isMobile||!i.disableMobile){if("click"===n){if(!i)return datepickers.forEach(hideCal);if(i.disabled)return;var o=i.calendar,l=i.calendarContainer,d=i.disableYearOverlay,c=i.nonInput,u=o.querySelector(".qs-overlay-year"),h=!!o.querySelector(".qs-hidden"),v=o.querySelector(".qs-month-year").contains(a),f=a.dataset.monthNum;if(i.noPosition&&!s)(l.classList.contains("qs-hidden")?showCal:hideCal)(i);else if(r.contains("qs-arrow"))changeMonthYear(r,i);else if(v||r.contains("qs-close"))d||toggleOverlay(!h,i);else if(f)overlayYearEntry(e,u,i,f);else if(r.contains("qs-disabled"))return;else if(r.contains("qs-num")){var m=a.textContent,y=+a.dataset.direction,p=new Date(i.currentYear,i.currentMonth+y,m);if(y){i.currentYear=p.getFullYear(),i.currentMonth=p.getMonth(),i.currentMonthName=months[i.currentMonth],renderCalendar(i);for(var g,D=i.calendar.querySelectorAll('[data-direction="0"]'),w=0;!g;){var b=D[w];b.textContent===m&&(g=b),w++}a=g}+p==+i.dateSelected?selectDay(a,i,!0):a.classList.contains("qs-disabled")||selectDay(a,i);return}else r.contains("qs-submit")?overlayYearEntry(e,u,i):c&&a===i.el&&(showCal(i),hideOtherPickers(i))}else if("focusin"===n&&i)showCal(i),hideOtherPickers(i);else if("keydown"===n&&9===t&&i)hideCal(i);else if("keydown"===n&&i&&!i.disabled){var q=!i.calendar.querySelector(".qs-overlay").classList.contains("qs-hidden");13===t&&q&&s?overlayYearEntry(e,a,i):27===t&&q&&s&&toggleOverlay(!0,i)}else if("input"===n){if(!i||!i.calendar.contains(a))return;var M=i.calendar.querySelector(".qs-submit"),C=a.value.split("").reduce(function(e,t){return e||"0"!==t?e+(t.match(/[0-9]/)?t:""):""},"").slice(0,4);a.value=C,M.classList[4===C.length?"remove":"add"]("qs-disabled")}}}}function shadowDomHandler(e){oneHandler(e),e.__qs_shadow_dom=!0}function removeEvents(e,t){events.forEach(function(n){e.removeEventListener(n,t)})}function show(){showCal(this)}function hide(){hideCal(this)}function setDate(e,t){var n=stripTime(e),a=this.currentYear,r=this.currentMonth,i=this.sibling;if(null==e)return this.dateSelected=void 0,setCalendarInputValue(this.el,this,!0),i&&(adjustDateranges({instance:this,deselect:!0}),renderCalendar(i)),renderCalendar(this),this;if(!dateCheck(e))throw Error("`setDate` needs a JavaScript Date object.");if(this.disabledDates[+n]||n<this.minDate||n>this.maxDate)throw Error("You can't manually set a date that's disabled.");this.dateSelected=n,t&&(this.currentYear=n.getFullYear(),this.currentMonth=n.getMonth(),this.currentMonthName=this.months[n.getMonth()]),setCalendarInputValue(this.el,this),i&&(adjustDateranges({instance:this}),renderCalendar(i));var s=a===n.getFullYear()&&r===n.getMonth();return s||t?renderCalendar(this,n):s||renderCalendar(this,new Date(a,r,1)),this}function setMin(e){return changeMinOrMax(this,e,!0)}function setMax(e){return changeMinOrMax(this,e)}function changeMinOrMax(e,t,n){var a=e.dateSelected,r=e.first,i=e.sibling,s=e.minDate,o=e.maxDate,l=stripTime(t),d=n?"Min":"Max";function c(){return"original"+d+"Date"}function u(){return d.toLowerCase()+"Date"}function h(){return"set"+d}function v(){throw Error("Out-of-range date passed to "+h())}if(null==t)e[c()]=void 0,i?(i[c()]=void 0,n?(!r||a)&&(r||i.dateSelected)||(e.minDate=void 0,i.minDate=void 0):(!r||i.dateSelected)&&(r||a)||(e.maxDate=void 0,i.maxDate=void 0)):e[u()]=void 0;else if(dateCheck(t))i?((r&&n&&l>(a||o)||r&&!n&&l<(i.dateSelected||s)||!r&&n&&l>(i.dateSelected||o)||!r&&!n&&l<(a||s))&&v(),e[c()]=l,i[c()]=l,(!n||(!r||a)&&(r||i.dateSelected))&&(n||(!r||i.dateSelected)&&(r||a))||(e[u()]=l,i[u()]=l)):((n&&l>(a||o)||!n&&l<(a||s))&&v(),e[u()]=l);else throw Error("Invalid date passed to "+h());return i&&renderCalendar(i),renderCalendar(e),e}function getRange(){var e=this.first?this:this.sibling,t=e.sibling;return{start:e.dateSelected,end:t.dateSelected}}function remove(){var e=this.shadowDom,t=this.positionedEl,n=this.calendarContainer,a=this.sibling,r=this;this.inlinePosition&&(datepickers.some(function(e){return e!==r&&e.positionedEl===t})||t.style.setProperty("position",null)),n.remove(),datepickers=datepickers.filter(function(e){return e!==r}),a&&delete a.sibling,datepickers.length||removeEvents(document,oneHandler);var i=datepickers.some(function(t){return t.shadowDom===e});for(var s in e&&!i&&removeEvents(e,shadowDomHandler),this)delete this[s];datepickers.length||events.forEach(function(e){document.removeEventListener(e,oneHandler)})}function navigate(e,t){var n=new Date(e);if(!dateCheck(n))throw Error("Invalid date passed to `navigate`");this.currentYear=n.getFullYear(),this.currentMonth=n.getMonth(),renderCalendar(this),t&&this.onMonthChange(this)}function instanceToggleOverlay(){var e=!this.calendarContainer.classList.contains("qs-hidden"),t=!this.calendarContainer.querySelector(".qs-overlay").classList.contains("qs-hidden");e&&toggleOverlay(t,this)}
